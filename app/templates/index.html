{% extends "base.html" %}

{% block title %}Alteran - Портфолио проектов{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <h1 class="hero-title">Наши проекты</h1>
        <p class="hero-subtitle">Реализованные решения для бизнеса</p>
    </div>
</div>

<!-- Вкладка: Проекты -->
<div class="tab-content active" id="tab-projects">
    <div class="projects-section">
        <div class="container">
            {% if projects %}
                <div class="projects-grid">
                    {% for project in projects %}
                    <div class="project-card{% if project.github_url %} project-card--has-github{% endif %}"{% if project.github_url %} data-github-url="{{ project.github_url }}"{% endif %}>
                        <div class="project-card-inner">
                            <div class="project-card-front">
                                <div class="project-header">
                                    <h2 class="project-title">{{ project.title }}</h2>
                                    <span class="project-industry">{{ project.industry }}</span>
                                </div>

                                {% if project.images %}
                                <div class="project-images">
                                    {% for image in project.images %}
                                    <img src="/static/{{ image }}" alt="{{ project.title }}" class="project-image image-modal-trigger" data-image-src="/static/{{ image }}">
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <div class="project-results">
                                    <h3 class="section-title">Результат</h3>
                                    <ul class="results-list">
                                        {% for result in project.results %}
                                        <li class="result-item">{{ result }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>

                                <div class="project-resources">
                                    <div class="resource-item">
                                        <span class="resource-label">Сроки:</span>
                                        <span class="resource-value">{{ project.timeline }}</span>
                                    </div>
                                    <div class="resource-item">
                                        <span class="resource-label">Бюджет:</span>
                                        <span class="resource-value">{{ project.budget }}</span>
                                    </div>
                                </div>

                                {% if project.benefits %}
                                <div class="project-benefits">
                                    <h3 class="section-title">Выгода для клиента</h3>
                                    <p class="benefits-text">{{ project.benefits }}</p>
                                </div>
                                {% endif %}

                                {% if project.tech_stack %}
                                <div class="project-tech-stack">
                                    <h3 class="section-title">Стек</h3>
                                    <div class="tech-stack-grid">
                                        {% for key, value in project.tech_stack.items() %}
                                        <div class="tech-item">
                                            {% set icon_path = get_tech_icon(key) %}
                                            {% if icon_path %}
                                            <div class="tech-icon">
                                                <img src="/static/{{ icon_path }}" alt="{{ key }}" class="tech-icon-img">
                                            </div>
                                            {% endif %}
                                            <div class="tech-content">
                                                <span class="tech-label">{{ key }}:</span>
                                                {% if value %}
                                                <div class="tech-tags">
                                                    {% set tech_list = value.split(',') %}
                                                    {% for tech in tech_list %}
                                                        {% set tech_clean = tech.strip() %}
                                                        {% if tech_clean %}
                                                        <span class="tech-tag">{{ tech_clean }}</span>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="project-card-back">
                                {% if project.github_url %}
                                <a href="{{ project.github_url }}" target="_blank" rel="noopener noreferrer" class="project-back-github-link" onclick="event.stopPropagation();">
                                    <svg class="project-back-github-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </a>
                                {% else %}
                                <div class="project-back-no-link">
                                    <svg class="project-back-github-icon project-back-github-icon--muted" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Проекты пока не добавлены</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Вкладка: Мелкие доработки -->
<div class="tab-content" id="tab-tweaks">
    <div class="tweaks-section">
        <div class="container">
            {% if tweaks %}
                <!-- Фильтр по категориям -->
                <div class="tweaks-filters">
                    <button class="tweak-filter active" data-category="all">Все</button>
                    {% for cat_key, cat_name in tweak_categories.items() %}
                        {% set cat_count = tweaks|selectattr('category', 'equalto', cat_key)|list|length %}
                        {% if cat_count > 0 %}
                        <button class="tweak-filter" data-category="{{ cat_key }}">
                            {{ cat_name }} <span class="filter-count">{{ cat_count }}</span>
                        </button>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- Список доработок -->
                <div class="tweaks-grid">
                    {% for tweak in tweaks %}
                    <div class="tweak-card" data-category="{{ tweak.category }}"{% if tweak.github_url %} data-github-url="{{ tweak.github_url }}"{% endif %}>
                        <div class="tweak-card-inner">
                            <div class="tweak-card-front">
                                <div class="tweak-card-header">
                                    <span class="tweak-category tweak-category--{{ tweak.category }}">
                                        {{ tweak_categories.get(tweak.category, tweak.category) }}
                                    </span>
                                    {% if tweak.time_spent %}
                                    <span class="tweak-time">{{ tweak.time_spent }}</span>
                                    {% endif %}
                                </div>
                                <h3 class="tweak-title">{{ tweak.title }}</h3>
                                <p class="tweak-description">{{ tweak.description }}</p>
                                <div class="tweak-card-footer">
                                    {% if tweak.project_name %}
                                    <span class="tweak-project">{{ tweak.project_name }}</span>
                                    {% endif %}
                                    <span class="tweak-date">{{ tweak.created_at.strftime('%d.%m.%Y') }}</span>
                                </div>
                            </div>
                            <div class="tweak-card-back">
                                {% if tweak.github_url %}
                                <a href="{{ tweak.github_url }}" target="_blank" rel="noopener noreferrer" class="tweak-back-github-link" onclick="event.stopPropagation();">
                                    <svg class="tweak-back-github-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                </a>
                                {% else %}
                                <div class="tweak-back-no-link">
                                    <svg class="tweak-back-github-icon tweak-back-github-icon--muted" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                                    </svg>
                                    <span class="tweak-back-no-link-text">Нет ссылки</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Мелкие доработки пока не добавлены</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Модальное окно для увеличения изображений -->
<div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" id="modalImage" alt="Увеличенное изображение">
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/main.js"></script>
{% endblock %}
