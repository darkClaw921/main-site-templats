# Архитектура проекта

## Структура проекта

```
main-site-templats/
├── app/                          # Основное приложение
│   ├── __init__.py              # Инициализация пакета
│   ├── main.py                  # Точка входа FastAPI приложения
│   ├── config.py                # Конфигурация приложения (настройки из .env)
│   ├── database.py              # SQLAlchemy модели и подключение к БД
│   ├── schemas.py               # Pydantic схемы для валидации данных
│   ├── auth.py                  # Система аутентификации админа
│   ├── utils.py                 # Утилиты для работы с проектами
│   ├── llm.py                   # Модуль для работы с LLM (OpenAI) и генерации проектов
│   ├── routers/                 # Роутеры приложения
│   │   ├── __init__.py
│   │   ├── projects.py         # Публичный роутер для отображения проектов
│   │   └── admin.py            # Админ-роутер для управления проектами (CRUD)
│   ├── templates/               # HTML шаблоны Jinja2
│   │   ├── base.html           # Базовый шаблон с навигацией
│   │   ├── index.html          # Главная страница (лендинг)
│   │   └── admin/              # Шаблоны админ-панели
│   │       ├── login.html      # Страница входа
│   │       ├── dashboard.html  # Дашборд со списком проектов
│   │       └── project_form.html # Форма создания/редактирования проекта
│   └── static/                  # Статические файлы
│       ├── css/
│       │   └── style.css       # Стили приложения
│       ├── js/
│       │   ├── main.js         # JavaScript для интерактивности
│       │   └── particles.js    # JavaScript для анимации частиц фона
│       ├── fonts/              # Шрифты
│       │   └── alteran.ttf     # Шрифт Alteran для частиц фона
│       ├── icons/              # SVG иконки для категорий технологий
│       │   ├── frontend.svg    # Иконка для Frontend
│       │   ├── backend.svg     # Иконка для Backend
│       │   ├── database.svg    # Иконка для Database
│       │   ├── mobile.svg      # Иконка для Mobile
│       │   ├── devops.svg      # Иконка для DevOps
│       │   ├── design.svg      # Иконка для Design
│       │   ├── testing.svg     # Иконка для Testing
│       │   ├── cloud.svg       # Иконка для Cloud
│       │   └── api.svg         # Иконка для API
│       └── uploads/            # Загруженные изображения проектов
├── .env                         # Переменные окружения (не в git)
├── .env.example                 # Пример файла окружения
├── .dockerignore                # Исключения для Docker сборки
├── Dockerfile                   # Конфигурация Docker контейнера
├── docker-compose.yml           # Конфигурация Docker Compose для запуска с volume
├── pyproject.toml               # Зависимости проекта
├── uv.lock                      # Заблокированные версии зависимостей
├── architecture.md             # Документация архитектуры
└── README.md                   # Инструкции по запуску
```

## Компоненты системы

### app/main.py
Главный файл приложения. Инициализирует FastAPI с lifespan context manager для управления жизненным циклом (инициализация БД при старте). Подключает middleware для сессий и CORS, монтирует статические файлы, регистрирует роутеры projects и admin.

### app/config.py
Модуль конфигурации. Загружает настройки из переменных окружения через pydantic-settings (Pydantic V2). Содержит пароль админа, секретный ключ для сессий, URL базы данных, директорию для загрузок, настройки CORS, API ключ OpenAI (OPENAI_KEY). Метод get_cors_origins() возвращает список разрешенных источников для CORS.

### app/database.py
Модуль работы с базой данных. Определяет SQLAlchemy модель Project с методами для работы с JSON полями (results, tech_stack, images). Метод get_tech_stack_dict() имеет обработку ошибок JSONDecodeError для устойчивости к некорректным данным. Содержит функции для создания сессий БД и инициализации таблиц. Экспортирует типизацию SessionDep для dependency injection через Depends.

### app/schemas.py
Pydantic схемы для валидации данных API (Pydantic V2). Содержит ProjectBase, ProjectCreate, ProjectUpdate, ProjectResponse для работы с проектами, LoginRequest для аутентификации. Использует ConfigDict для конфигурации моделей.

### app/auth.py
Система аутентификации. Проверяет пароль админа из конфигурации, управляет сессией через cookies. Содержит функцию require_admin для защиты админских роутов через dependency injection. Экспортирует типизацию AdminDep для использования в роутерах.

### app/utils.py
Утилиты для работы с проектами. Содержит функции:
- project_to_dict() - преобразование модели Project в словарь для шаблонов, с обработкой ошибок при парсинге tech_stack
- parse_form_results() - парсинг результатов из формы
- parse_form_tech_stack() - парсинг технологического стека из формы
- save_uploaded_images() - сохранение загруженных изображений
- parse_existing_images() - парсинг существующих изображений из формы
- get_tech_icon() - получение пути к SVG иконке для категории технологии (Frontend, Backend, Database и т.д.)

### app/llm.py
Модуль для работы с LLM и генерации проектов. Содержит функции:
- get_github_repo_info() - получение информации о GitHub репозитории через API (описание, README, язык, темы)
- generate_project_with_llm() - генерация структурированного описания проекта через OpenAI GPT-4o-mini на основе текстового описания или информации о репозитории

### app/routers/projects.py
Публичный роутер без prefix. Обрабатывает GET / (главная страница с лендингом) и GET /api/projects (JSON API со списком проектов). Рендерит HTML шаблоны с данными проектов из базы. Использует SessionDep для dependency injection и функции из utils для преобразования данных. Передает функцию get_tech_icon в контекст шаблона для отображения иконок технологий.

### app/routers/admin.py
Админ-роутер с CRUD операциями. Обрабатывает:
- GET /admin/login - страница входа
- POST /admin/login - аутентификация
- GET /admin/logout - выход
- GET /admin/dashboard - дашборд со списком проектов
- GET /admin/projects/new - форма создания проекта
- POST /admin/projects - создание проекта
- POST /admin/projects/generate - генерация проекта через LLM на основе текстового описания
- POST /admin/projects/generate-from-github - генерация проекта через LLM на основе GitHub репозитория
- GET /admin/projects/{id}/edit - форма редактирования
- POST /admin/projects/{id} - обновление проекта
- POST /admin/projects/{id}/delete - удаление проекта

Использует AdminDep и SessionDep для dependency injection. Использует функции из utils для парсинга форм и работы с изображениями. Использует функции из llm для генерации проектов через OpenAI GPT-4o-mini.

### app/templates/
HTML шаблоны на Jinja2:
- base.html - базовый шаблон с header, footer, навигацией, содержит блок scripts для подключения JavaScript файлов, подключает main.js и particles.js для интерактивности и анимации частиц фона
- index.html - лендинг с карточками проектов, отображает SVG иконки для категорий технологий в tech-item элементах, разбивает значения технологий по запятым и отображает их как отдельные теги (tech-tag) в контейнере tech-tags, содержит модальное окно для увеличения изображений проектов при клике
- admin/login.html - форма входа
- admin/dashboard.html - таблица проектов с действиями
- admin/project_form.html - форма создания/редактирования с динамическим добавлением технологий, содержит секцию для генерации проекта через LLM (по тексту или GitHub репозиторию), поле значений технологий (tech_stack_values) реализовано как расширяемый textarea с автоподстройкой высоты

### app/static/css/style.css
Стили приложения. Использует светло-зеленые акценты в соответствии с дизайном. Адаптивная верстка для мобильных устройств. Стили для админ-панели включены. Подключает шрифт Alteran через @font-face для использования в частицах фона. Содержит стили для фоновых частиц: particles-background (фиксированный контейнер на заднем плане с z-index: -1, pointer-events: none), particle (абсолютно позиционированные элементы с шрифтом Alteran, полупрозрачным зеленым цветом, различными размерами). Содержит классы для отображения технологий: tech-tags (контейнер с flex-wrap для переноса тегов) и tech-tag (отдельные теги технологий с белым фоном, box-shadow вместо border для плавного визуального эффекта, transition для плавных переходов и hover эффект с легким подъемом). Все контейнеры имеют max-width: 100%, box-sizing: border-box и overflow-wrap для предотвращения выхода контента за пределы. tech-stack-grid использует grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) для заполнения всей доступной ширины. На мобильных устройствах tech-item отображается в колонку (flex-direction: column). Содержит стили для модального окна увеличения изображений: image-modal (overlay с затемненным фоном), image-modal-content (увеличенное изображение с анимацией появления), image-modal-close (кнопка закрытия). Изображения проектов имеют cursor: pointer и hover эффект с увеличением. Содержит стили для расширяемого textarea в форме технологий: tech-stack-textarea (минимальная высота 44px, максимальная 300px, без ручного изменения размера, автоматическая подстройка высоты через JavaScript).

### app/static/js/main.js
JavaScript модуль для интерактивности приложения. Содержит обработчики событий для модального окна увеличения изображений проектов: открытие модального окна при клике на изображение с классом image-modal-trigger, закрытие при клике на кнопку закрытия, закрытие при клике вне изображения, закрытие при нажатии клавиши Escape. Блокирует прокрутку страницы при открытом модальном окне.

### app/static/js/particles.js
JavaScript модуль для анимации фоновых частиц с буквами. Создает контейнер particles-background и генерирует 50 частиц с случайными английскими буквами A-Z, используя шрифт Alteran. Каждая частица имеет случайную позицию, размер (от 1.5rem до 3rem), скорость движения и прозрачность (от 0.1 до 0.2). Частицы плавно перемещаются по экрану с отскоком от границ окна. Использует requestAnimationFrame для плавной анимации. Обрабатывает изменение размера окна для корректного отображения частиц при ресайзе.

## Модель данных

### Project (projects таблица)
- id (Integer, PK) - идентификатор проекта
- title (String) - название проекта
- industry (String) - отрасль
- results (Text, JSON) - список результатов проекта
- timeline (String) - сроки проекта
- budget (String) - бюджет проекта
- benefits (Text) - выгода для клиента
- tech_stack (Text, JSON) - словарь технологического стека
- images (Text, JSON) - список путей к изображениям
- created_at (DateTime) - дата создания
- updated_at (DateTime) - дата обновления

Методы модели:
- get_results_list() - получить список результатов
- set_results_list() - установить список результатов
- get_tech_stack_dict() - получить словарь технологий
- set_tech_stack_dict() - установить словарь технологий
- get_images_list() - получить список изображений
- set_images_list() - установить список изображений

## Поток данных

1. Публичный доступ: Пользователь -> GET / -> projects.router -> database -> templates -> HTML ответ
2. Админ-доступ: Админ -> POST /admin/login -> auth.verify_password -> сессия -> доступ к админ-роутерам
3. Создание проекта: Админ -> форма -> POST /admin/projects -> парсинг данных -> сохранение изображений -> database -> редирект на dashboard
4. Редактирование проекта: Админ -> GET /admin/projects/{id}/edit -> загрузка данных -> форма -> POST /admin/projects/{id} -> обновление БД
5. Удаление проекта: Админ -> POST /admin/projects/{id}/delete -> удаление изображений -> удаление из БД

## Технологический стек

- FastAPI - веб-фреймворк
- SQLAlchemy - ORM для работы с БД
- SQLite - база данных
- Jinja2 - шаблонизатор
- Pydantic - валидация данных
- Starlette - middleware для сессий
- Python-multipart - обработка загрузки файлов
- OpenAI - API для работы с GPT-4o-mini моделью
- httpx - HTTP клиент для запросов к GitHub API
- uv - менеджер зависимостей Python
- Docker - контейнеризация приложения

## Docker

### Dockerfile
Конфигурация Docker контейнера для запуска приложения. Использует Python 3.12-slim образ, устанавливает uv для управления зависимостями, копирует файлы проекта и запускает приложение через uvicorn на порту 8000 с флагом --reload для поддержки hot reload. Создает директорию для загрузок изображений при сборке образа.

### docker-compose.yml
Конфигурация Docker Compose для удобного запуска приложения. Монтирует всю папку проекта как volume для автоматического применения изменений кода без пересборки контейнера. Исключает виртуальное окружение из volume (оно создается внутри контейнера). Загружает переменные окружения из .env файла. Настраивает порт 8000 и автоматический перезапуск контейнера.

### .dockerignore
Файл исключений для Docker сборки. Исключает из контекста сборки ненужные файлы: git репозиторий, кэш Python, виртуальные окружения, переменные окружения, документацию, скриншоты, базы данных и временные файлы.